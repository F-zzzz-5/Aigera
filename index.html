<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>You.</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .fade-in {
      /* For overall page transitions */
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .image-reveal {
      opacity: 0;
      transition: opacity 2s ease;
      /* Slower reveal for images */
    }

    .grid-cell {
      width: 100px;
      /* Larger for 3x3 */
      height: 100px;
      border: 2px solid #ccc;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .grid-cell.locked {
      background-color: #f0f0f0;
      color: #999;
    }

    .grid-cell.unlocked {
      background-color: #e6e6e6;
      /* Slightly different shade */
      color: #666;
      cursor: default;
    }

    .song-block {
      background-color: #f0f0f0;
      padding: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      border: 1px solid #ddd;
      transition: opacity 0.5s ease;
    }

    .song-block.revealed {
      opacity: 1;
      pointer-events: none;
    }

    /* Modal adjustments for mobile */
    @media (max-width: 640px) { /* sm breakpoint in Tailwind */
        #image-modal .bg-white {
            max-width: 80%; /* Adjust as needed */
            max-height: 80vh; /* Limit height as well */
            overflow-y: auto; /* Add scroll if content overflows */
        }
        #modal-image{
            max-height: 40vh;
        }
    }

    @media (max-width: 400px){
        #image-modal .bg-white {
            max-width: 95%; /* Adjust as needed */
            max-height: 95vh; /* Limit height as well */
            overflow-y: auto; /* Add scroll if content overflows */
        }
    }

    /* Inside your <style> tag*/
      #speech-bubble-container {
        position: absolute; /* Key for positioning */
        z-index: 10;     /* Ensure it's above other elements */
    }

    #final-message {
        position: relative; /* For the pseudo-element */
        display: inline-block; /* Important for sizing */
    }

    /* Speech bubble triangle (pointing down) */
    #final-message::after {
        content: '';
        position: absolute;
        bottom: 100%;  /* Position at the bottom of the message box*/
        left: 50%;
        margin-left: -10px; /* Half of the triangle width */
        border-width: 10px;
        border-style: solid;
        border-color: transparent transparent white transparent; /* Creates the triangle */
    }
  </style>
</head>

<body class="bg-pink-100 font-sans">

  <div id="page-container" class="flex flex-col items-center justify-center min-h-screen">

    <section id="page-1" class="page p-4 text-center fade-in" style="opacity:1">
      <h1 class="text-2xl font-bold mb-4">Enter Your Name:</h1>
      <input type="text" id="name-input" class="border p-2 rounded" placeholder="Your Name">
      <button id="submit-name"
        class="mt-4 bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded">Submit</button>
    </section>

    <section id="page-2" class="page hidden p-4 text-center fade-in">
      <h1 class="text-2xl font-bold mb-4">Where is this image from..?</h1>
      <div id="cropped-image-container" class="mb-4" style="width:150px">
      </div>
      <button id="reveal-button"
        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Reveal</button>
      <img id="full-image" src="" alt="Full Image" class="mx-auto mt-4 image-reveal" style="max-width: 400px;">
      <button id="next-image" class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Next
        Image</button>
    </section>

    <section id="page-3" class="page hidden p-4 text-center fade-in">
      <h1 class="text-2xl font-bold mb-4">A glimpse into the past...</h1>
      <div id="grid-container" class="grid grid-cols-3 gap-2"> </div>
      <button id="next-grid"
        class="mt-4 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded hidden">Next</button>
    </section>

    <section id="page-4" class="page hidden p-4 text-center fade-in">
      <h1 class="text-2xl font-bold mb-4">Songs That Remind Me of You</h1>
      <div id="song-container">
      </div>
      <button id="next-songs"
        class="mt-4 bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded hidden">Next</button>
    </section>
  </div>

  <div id="image-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-lg max-w-md w-full">
      <img id="modal-image" src="" alt="Memory" class="mx-auto mb-2" style="max-width: 100%;">
      <p id="modal-text" class="text-center"></p>
      <button id="close-modal"
        class="mt-4 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Close</button>
    </div>
  </div>
  <script>
    // --- Page Navigation and Overall Structure ---
    let currentPage = 1;
    const pages = document.querySelectorAll('.page');

    function showPage(pageNumber) {
      pages.forEach(page => page.classList.add('hidden'));
      document.getElementById(`page-${pageNumber}`).classList.remove('hidden');
      document.getElementById(`page-${pageNumber}`).classList.add('fade-in');
      // Reset opacity for fade-in effect on subsequent visits
      setTimeout(() => document.getElementById(`page-${pageNumber}`).style.opacity = 1, 0);
    }

    // --- Page 1: Name Input ---
    const nameInput = document.getElementById('name-input');
    const submitNameButton = document.getElementById('submit-name');

    submitNameButton.addEventListener('click', () => {
      if (nameInput.value.trim().toLowerCase() === 'aigera') {
        currentPage = 2;
        showPage(5);
        initializeThenNow()//initializeImageGame(); // Start the image game
      } else {
        alert('Incorrect name. Try again!');
      }
    });

    // --- Page 2: Image Guessing Game (Now Image Reveal) ---

    const gameData = [
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344693135334178886/IMG_0875.jpg?ex=67c1d692&is=67c08512&hm=22fbe0dde17b93c19609f589a40577afc1c976e10f9c24a6b2ba473343304825&=&format=webp&width=399&height=709", answer: "Image 1" }, // Answers no longer used
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344693135762260110/IMG_0707.jpg?ex=67c1d692&is=67c08512&hm=6e9c573b5055202ebbb08520baf73aef88d2749013f3af26b94fc3f739113235&=&format=webp&width=399&height=709", answer: "Image 2" },
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344693136106061885/IMG_0567.jpg?ex=67c1d692&is=67c08512&hm=b1efd3011ea6a7a8b98191a914c0c3bd5f3701b2db0029f1a3b0132bbbb54f91&=&format=webp&width=399&height=709", answer: "Image 3" },
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344693136575828028/IMG_0407.jpg?ex=67c1d692&is=67c08512&hm=1644b4ffc59e6e4ef7a2e0a9fe38f388d1992f2f9ce60a0fa3d5b857f8875611&=&format=webp&width=399&height=709", answer: "Image 4" },
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344693136919629947/IMG_0371.jpg?ex=67c1d693&is=67c08513&hm=e5ab15e85db2e50483cf96ada7e0d3d54becf57e51c4a2f665d608aeb9bdb7cc&=&format=webp&width=399&height=709", answer: "Image 5" },
    ];
    let currentImageIndex = 0;
    const croppedImageContainer = document.getElementById('cropped-image-container');
    const revealButton = document.getElementById('reveal-button');
    const fullImage = document.getElementById('full-image');
    const nextImageButton = document.getElementById('next-image');
    let canvas;
    let ctx;
    //  let currentImageData; // No longer strictly needed, but good for consistency

    function initializeImageGame() {
      currentImageIndex = 0;
      loadImage(currentImageIndex);
    }

    function loadImage(index) {
      if (index >= gameData.length) {
        // Game Over - proceed to the next page
        currentPage = 3;
        showPage(currentPage);
        initializeGridGame(); // Setup the grid game
        return;
      }

      const img = new Image();
      img.src = gameData[index].image;
      img.crossOrigin = "anonymous";
      img.onload = () => {
        // Create a temporary canvas to draw and extract image data
        canvas = document.createElement('canvas');
        canvas.classList.add("border");
        canvas.width = 150;
        canvas.height = 150;
        ctx = canvas.getContext('2d');

        // Randomly select a 50x50 section
        const x = Math.floor(Math.random() * (img.width - 150));
        const y = Math.floor(Math.random() * (img.height - 150));

        ctx.drawImage(img, x, y, 150, 150, 0, 0, 150, 150);
        if (croppedImageContainer.firstChild) {
          croppedImageContainer.removeChild(croppedImageContainer.firstChild); //clear if one already exists
        }
        croppedImageContainer.appendChild(canvas);


        // Reset full image
        fullImage.src = '';
        fullImage.style.opacity = 0;
      };
    }

    revealButton.addEventListener('click', () => {
      fullImage.src = gameData[currentImageIndex].image;
      fullImage.onload = () => {
        fullImage.style.opacity = 1; // Reveal slowly
      }

    });

    nextImageButton.addEventListener('click', () => {
      if (fullImage.style.opacity == 1) {
        currentImageIndex++;
        loadImage(currentImageIndex);
      }
      else {
        alert("You must reveal the image!"); //Kept this to maintain the game integrity.
      }
    });



    // --- Page 3: 3x3 Grid Game ---
    const gridContainer = document.getElementById('grid-container');
    const imageModal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    const modalText = document.getElementById('modal-text');
    const closeModalButton = document.getElementById('close-modal');
    const nextGridButton = document.getElementById('next-grid');
    let unlockedCount = 0;

    const gridData = [
      { image: "https://cdn.discordapp.com/attachments/1339586632181092386/1344700626931810395/ips-2078D123-C408-4689-A61C-808E54143499.mov?ex=67c1dd8c&is=67c08c0c&hm=fe3085384349e70906b4748c65da6dbc73c80c585ca0c686c0194e9a0cfbaed0&", text: "Us in Antalya, Turkey", timestamp: "2024-07-15T13:55:00" }, // Example timestamp
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344701825731002489/IMG_2369.jpg?ex=67c1deaa&is=67c08d2a&hm=284cc83702642501738939cbc134688271a3dea90086baf62ebcabfa54d16935&=&format=webp&width=399&height=709", text: "First time in Prague", timestamp: "2024-10-14T12:33:00" }, // Example timestamp
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344702115372597318/IMG_2370.jpg?ex=67c1deef&is=67c08d6f&hm=9966b14bf85c99294aa9b9bcd7a1a6a7a2a950fe66d182485399df55a67177c5&=&format=webp&width=399&height=709", text: "Second time in Prague >:)", timestamp: "2024-11-02T11:55:00" }, // Example timestamp
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344702526557130782/IMG_2371.jpg?ex=67c1df51&is=67c08dd1&hm=588840f1658940f658649fa521d2073fe1ff518e84dd9c94979c22b2cbaf113d&=&format=webp&width=399&height=709", text: "Third time in Prague >>::))", timestamp: "2024-11-16T20:06:00" }, // Example timestamp
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344703339979477052/IMG_2372.jpg?ex=67c1e013&is=67c08e93&hm=5f0d960a5b9635a68a924e5341f99cef14c6043b4e92faaafa75aaba77e6594a&=&format=webp&width=399&height=709", text: "Fourth time in Prague.. holy shi", timestamp: "2024-11-30T17:13:00" }, // Example timestamp
      { image: "https://cdn.discordapp.com/attachments/1339586632181092386/1344703709233545277/5F481905-7F6A-4BDD-954A-9454B45ECC2E.mov?ex=67c1e06b&is=67c08eeb&hm=3b013b04fe59f6aff56f8276bdfcea6b1cb9a0e73a85edbaecb24323c527c372&", text: "First holiday together (in Thailand)", timestamp: "2024-12-29T09:44:00" }, // Example timestamp
      { image: "https://media.discordapp.net/attachments/1339586632181092386/1344704456184303708/IMG_2374.jpg?ex=67c1e11d&is=67c08f9d&hm=5c84f61f352ef5958c487c7233d3a44a316e05326d2fbc17326d74e90e269915&=&format=webp&width=399&height=709", text: "Back in Prague", timestamp: "2025-01-04T17:42:00" }, // Example timestamp
      { image: "https://cdn.discordapp.com/attachments/1339586632181092386/1344704949992292373/ips-1C1777CB-C3F1-416D-93A4-0C8DBD50AD88.mov?ex=67c1e193&is=67c09013&hm=bbc7d28b0061ac6b7ed7968f82627d9def9057ed36a185a1deebe2dcf499f7c5&", text: "R12 Botanics Free Advertisement", timestamp: "2025-02-10T15:13:00" }, // Example timestamp
      { image: "https://cdn.discordapp.com/attachments/1339586632181092386/1344705276498153572/939897D0-B34C-44A3-AF92-E502F19B3B0C.mov?ex=67c1e1e1&is=67c09061&hm=f9ca61de39323a98b1d09817a8d5a3b706eaec0061f78b7eac0e6466cca0bb32&", text: "This gyal is too leng icl", timestamp: "2025-02-23T11:53:00" }, // Example timestamp
    ];

    function initializeGridGame() {
      unlockedCount = 0;
      gridContainer.innerHTML = ''; // Clear any existing cells.
      nextGridButton.classList.add('hidden');


      gridData.forEach((data, index) => {
        const cell = document.createElement('div');
        cell.classList.add('grid-cell', 'locked');
        cell.textContent = 'Locked';
        cell.dataset.index = index; // Store the index

        cell.addEventListener('click', () => {
          if (cell.classList.contains('locked')) {
            openCell(cell, data);
          }
        });
        gridContainer.appendChild(cell);
      });
    }

    function openCell(cell, data) {
      modalImage.src = data.image;
      modalText.textContent = `${data.text}, ${timeAgo(data.timestamp)}`;
      imageModal.classList.remove('hidden');
      cell.classList.remove('locked');
      cell.classList.add('unlocked');
      cell.textContent = ''; // Remove "Locked" text
      unlockedCount++;

      if (unlockedCount === gridData.length) {
        nextGridButton.classList.remove('hidden');
      }
    }


    closeModalButton.addEventListener('click', () => {
      imageModal.classList.add('hidden');
    });

    nextGridButton.addEventListener('click', () => {
      currentPage = 4;
      showPage(currentPage);
      initializeSongReveal(); // Will be defined in Part 2
    });

    function timeAgo(timestamp) {
      const now = new Date();
      const pastDate = new Date(timestamp);
      const diffInSeconds = Math.floor((now - pastDate) / 1000);

      const days = Math.floor(diffInSeconds / (60 * 60 * 24));
      const hours = Math.floor((diffInSeconds % (60 * 60 * 24)) / (60 * 60));
      const minutes = Math.floor((diffInSeconds % (60 * 60)) / 60);
      const seconds = diffInSeconds % 60;


      let result = "";
      if (days > 0) result += `${days} day${days > 1 ? 's' : ''} `;
      if (hours > 0) result += `${hours} hour${hours > 1 ? 's' : ''} `;
      if (days == 0 && minutes > 0) result += `${minutes} minute${minutes > 1 ? 's' : ''} `; //Show minutes if under a day
      if (days == 0 && hours == 0) result += `${seconds} second${seconds != 1 ? 's' : ''} `; //Show seconds if under an hour.

      return result + "ago";
    }
        // --- Page 4: Song Reveal ---

        const songContainer = document.getElementById('song-container');
        const nextSongsButton = document.getElementById('next-songs');
        let revealedSongs = 0;
        // let currentAudio = null;  // No longer needed for Spotify embeds

        const songsData = [
            { title: "The first song that reminded me of you", embed: '<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/4eWQlBRaTjPPUlzacqEeoQ?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>' },
            { title: "A song for us", embed: '<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/1ayO4rgvMNhRIxArrQGz39?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>' },
        ];

        function initializeSongReveal() {
            revealedSongs = 0;
            nextSongsButton.classList.add('hidden');
            songContainer.innerHTML = '';

            songsData.forEach((song, index) => {
                const block = document.createElement('div');
                block.classList.add('song-block');
                block.textContent = song.title; // Initially show the title
                block.dataset.index = index;

                block.addEventListener('click', () => {
                    if (!block.classList.contains('revealed')) {
                        block.classList.add('revealed');
                        revealedSongs++;

                        // Directly set the innerHTML to the embed code.
                        block.innerHTML = song.embed;

                        if (revealedSongs === songsData.length) {
                            nextSongsButton.classList.remove('hidden');
                        }
                    }
                });

                songContainer.appendChild(block);
            });
        }

// --- Page 5: Then and Now --- (Add this section *after* the song reveal section)

const thenNowContainer = document.createElement('section'); // Create the section element
thenNowContainer.id = 'page-5';
thenNowContainer.classList.add('page', 'hidden', 'p-4', 'text-center', 'fade-in');
thenNowContainer.innerHTML = `
    <h1 class="text-2xl font-bold mb-4" id="then-now-title"></h1>
    <div class="flex justify-center space-x-4 mb-4">
        <img id="then-image-1" src="" alt="Then Image 1" class="w-48 h-48 object-cover">
        <img id="then-image-2" src="" alt="Then Image 2" class="w-48 h-48 object-cover">
    </div>
    <div class="flex justify-center space-x-4 mb-4 hidden">
            <img id="now-image-1" src="" alt="Now Image 1" class="w-48 h-48 object-cover">
        <img id="now-image-2" src="" alt="Now Image 2" class="w-48 h-48 object-cover">
    </div>
    <div class="relative" id="speech-bubble-container">
      <p id="final-message" class="text-lg hidden bg-white p-4 rounded-lg shadow-md"></p>
    </div>

`;
document.getElementById('page-container').appendChild(thenNowContainer); // Add to the main container

const thenNowTitle = document.getElementById('then-now-title');
const thenImage1 = document.getElementById('then-image-1');
const thenImage2 = document.getElementById('then-image-2');
const nowImage1 = document.getElementById('now-image-1');
const nowImage2 = document.getElementById('now-image-2');
const finalMessage = document.getElementById('final-message');
const speechBubbleContainer = document.getElementById('speech-bubble-container');

const thenNowData = {
    thenImages: ["https://media.discordapp.net/attachments/1339586632181092386/1344708813105664030/d3188d8c-4e99-417c-bda5-cc5fbba22b8c.jpg?ex=67c1e52c&is=67c093ac&hm=df9df7f934cf982f0f4b5c6d61dfd70795d77f768d117a9d155ce60cd1f95af6&=&format=webp&width=946&height=709", "https://media.discordapp.net/attachments/1339586632181092386/1344708813487603773/IMG_2365.png?ex=67c1e52c&is=67c093ac&hm=58c237a006420f6c349d43be8f6f634fe12f83bfb66c1559d2bc85d6c745bb65&=&format=webp&quality=lossless&width=519&height=709"], // Replace with your actual image paths
    nowImages: ["https://media.discordapp.net/attachments/1339586632181092386/1344718990513016852/image.png?ex=67c1eea7&is=67c09d27&hm=eb040ae7b5b0efe99d1e2f0690d6ee31f44483aac6a0677735dd01586a84b7ca&=&format=webp&quality=lossless&width=480&height=573", "https://media.discordapp.net/attachments/1339586632181092386/1344709166677229638/IMG_2378.png?ex=67c1e580&is=67c09400&hm=121c2cfbcf6d8de1bcb614eb6ed17edfc976b2734bc10b6a0e9473581e31ee07&=&format=webp&quality=lossless&width=571&height=709"],    // Replace with your actual image paths
    finalMessage: "No one could ever compare to you Aigera <3"
};
function initializeThenNow() {
    // Set Default states
    thenNowTitle.textContent = "We once were...";
    thenImage1.src = thenNowData.thenImages[0];
    thenImage2.src = thenNowData.thenImages[1];
    thenImage1.parentElement.classList.remove("hidden");
    thenImage2.parentElement.classList.remove("hidden"); // Show both "then" images
    nowImage1.parentElement.classList.add("hidden");
    finalMessage.classList.add("hidden");
    speechBubbleContainer.classList.add("hidden");

    setTimeout(() => {
        thenNowTitle.textContent = "Now we are...";
        thenImage1.parentElement.classList.add("hidden");
        thenImage2.parentElement.classList.add("hidden"); // Hide both "then" images
        nowImage1.parentElement.classList.remove("hidden");
        nowImage1.src = thenNowData.nowImages[0];
        nowImage2.src = thenNowData.nowImages[1];

        setTimeout(() => {
            // --- 1. Hide the *entire* container of the "now" images ---
            nowImage1.parentElement.classList.add("hidden");
            thenNowTitle.textContent = ""; // Clear the title text


            // --- 2. Create and insert the *new* "then" image (you) ---
            const newThenImage = document.createElement('img');
            newThenImage.src = thenNowData.thenImages[0];
            newThenImage.alt = "Then Image 1 (Repeat)";
            newThenImage.classList.add('w-48', 'h-48', 'object-cover', 'mx-auto');

            // Insert *before* the speech bubble container:
            speechBubbleContainer.before(newThenImage);

            // --- 3. Show the message and speech bubble ---
            finalMessage.textContent = thenNowData.finalMessage;
            finalMessage.classList.remove('hidden');
            speechBubbleContainer.classList.remove('hidden');

            // --- 4. Position the speech bubble AFTER the image loads ---
            newThenImage.onload = () => {
                positionSpeechBubble(newThenImage);
            };

        }, 4000);
    }, 4000);
}


function positionSpeechBubble(image) { // Takes the image element as input
  const imageRect = image.getBoundingClientRect();
  speechBubbleContainer.style.left = `${imageRect.left + window.scrollX + imageRect.width / 2 - speechBubbleContainer.offsetWidth / 2}px`;
  speechBubbleContainer.style.top = `${imageRect.bottom + window.scrollY + 10}px`;
}
 // Update position on resize
 window.addEventListener('resize', () => {
    // Check if we're on page 5 AND the final message is visible
    if (currentPage === 5 && !finalMessage.classList.contains('hidden')) {
      const image = document.querySelector("#page-5 img.mx-auto");
        if(image){
            positionSpeechBubble(image);
        }
    }
});

    // --- Modify nextSongsButton click handler ---
nextSongsButton.addEventListener('click', () => { //nextSongButton defined in other js code
    currentPage = 5;
    showPage(currentPage);
    initializeThenNow(); // Call this when the "Then and Now" page is shown
});


        // --- Modify nextSongsButton click handler ---
    nextSongsButton.addEventListener('click', () => {
        currentPage = 5;
        showPage(currentPage);
        initializeThenNow(); // Call this when the "Then and Now" page is shown
    });
  </script>
</body>

</html>
